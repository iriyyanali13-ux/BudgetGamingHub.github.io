<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Chat | Gaming Budget Hub</title>
    <style>
        html { scroll-behavior: smooth; }
        :root { --primary-neon: #00ffcc; --bg-deep: #0b0e14; --card-bg: #161b22; --highlight: #ffdb4d; }
        body.light-mode { --bg-deep: #f4f4f9; --card-bg: #ffffff; color: #333; }
        body { background-color: var(--bg-deep); color: #e6edf3; font-family: 'Segoe UI', sans-serif; margin: 0; transition: 0.3s; display: flex; flex-direction: column; min-height: 100vh; }
        
        .header { background: rgba(13, 17, 23, 0.95); border-bottom: 2px solid var(--primary-neon); display: flex; justify-content: space-between; align-items: center; padding: 1rem 5%; position: sticky; top: 0; z-index: 2000; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary-neon); text-transform: uppercase; }
        .nav { display: flex; align-items: center; }
        .nav a { color: #fff; text-decoration: none; margin-left: 20px; font-weight: 500; transition: 0.3s; }
        .nav a:hover { color: var(--primary-neon); }
        .nav a.active { color: var(--primary-neon); border-bottom: 2px solid var(--primary-neon); padding-bottom: 5px; }

        .container { max-width: 800px; margin: 40px auto; padding: 0 20px; flex: 1; display: flex; flex-direction: column; width: 100%; box-sizing: border-box; }
        .chat-card { background: var(--card-bg); border: 1px solid #30363d; border-radius: 12px; display: flex; flex-direction: column; height: 500px; overflow: hidden; }
        
        #chat-history { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .message { max-width: 80%; padding: 12px 18px; border-radius: 18px; font-size: 15px; line-height: 1.5; }
        .user-message { align-self: flex-end; background-color: var(--primary-neon); color: #0b0e14; border-bottom-right-radius: 4px; }
        .ai-message { align-self: flex-start; background-color: #30363d; color: #e6edf3; border-bottom-left-radius: 4px; }

        .typing { font-style: italic; color: #8b949e; margin-bottom: 10px; display: none; }

        .input-area { padding: 20px; background: rgba(0,0,0,0.2); border-top: 1px solid #30363d; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 12px; background: #0d1117; border: 1px solid #30363d; border-radius: 25px; color: #fff; outline: none; }
        .send-btn { background: var(--primary-neon); color: #0b0e14; border: none; padding: 10px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; }
        .send-btn:disabled { background: #30363d; cursor: not-allowed; }
    </style>
</head>
<body>

<header class="header">
    <div class="logo">Gaming Budget Hub</div>
    <nav class="nav">
        <a href="index.html">Home</a>
        <a href="builds.html">PC Builds</a>
        <a href="fps-guides.html">FPS Guides</a>
        <a href="fps-counter.html">FPS Counter</a>
        <a href="contact.html">Contact Us</a>
        <a href="Ai-Chat.html" class="active">AI-Chat</a>
    </nav>
</header>

<main class="container">
    <div class="chat-card">
        <div id="chat-history">
            <div class="message ai-message">Hello! I'm your Gaming Budget Assistant. How can I help you today?</div>
        </div>
        <div id="typing-indicator" class="typing" style="padding-left: 20px;">AI is thinking...</div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Ask about PC parts or FPS...">
            <button id="send-btn" class="send-btn">Send</button>
        </div>
    </div>
</main>

<script src="main.js"></script>

<script type="module">
    // Using direct CDN for maximum compatibility
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
    
    const API_KEY = "AIzaSyBS3ijU2RIIDQFnCfDaoV_EUxPIay3mdIM"; 
    
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
    const chatSession = model.startChat({
        history: [
            { role: "user", parts: [{ text: "You are a budget PC building expert in Pakistan. Help users with prices in PKR and suggest parts from the used market like Hafeez Center or Naz Plaza." }] },
            { role: "model", parts: [{ text: "Understood. I will help users build the best gaming PCs with local Pakistani prices in mind." }] }
        ],
    });

    const chatHistoryElement = document.getElementById('chat-history');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const typingIndicator = document.getElementById('typing-indicator');

    function appendMessage(text, isUser) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
        
        if (!isUser) {
            const formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                                     .replace(/\n/g, '<br>')
                                     .replace(/```([\s\S]*?)```/g, '<pre>$1</pre>');
            msgDiv.innerHTML = formattedText;
        } else {
            msgDiv.textContent = text;
        }
        
        chatHistoryElement.appendChild(msgDiv);
        chatHistoryElement.scrollTop = chatHistoryElement.scrollHeight;
    }

    async function handleSend() {
        const text = userInput.value.trim();
        if (!text) return;

        appendMessage(text, true);
        userInput.value = '';
        userInput.disabled = true;
        sendBtn.disabled = true;
        typingIndicator.style.display = 'block';

        try {
            const result = await chatSession.sendMessage(text);
            const response = await result.response;
            typingIndicator.style.display = 'none';
            appendMessage(response.text(), false);
        } catch (error) {
            typingIndicator.style.display = 'none';
            appendMessage("Error: Please check your internet connection or try again later.", false);
            console.error(error);
        } finally {
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
        }
    }

    // Attach the event listeners correctly
    sendBtn.addEventListener('click', handleSend);
    userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); });
</script>

</body>
</html>